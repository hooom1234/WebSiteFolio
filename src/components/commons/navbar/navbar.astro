---
import { FiMenu, FiX } from "react-icons/fi";
import NotificationBell from "./notificationBell.jsx";
import { FaLinkedinIn, FaGithub } from "react-icons/fa6";

const links = [
  { name: "Home", href: "/" },
  // { name: "Project", href: "/" },
  { name: "about", href: "/about" },
  
];
---

<nav class="relative">
  <input id="menu-toggle" type="checkbox" class="peer hidden md:hidden" />

  <nav
    id="navbar-header"
    class="fixed top-6 left-1/2 -translate-x-1/2 w-[95%] md:w-[85%] max-w-7xl z-50 
           bg-gray-950/60 backdrop-blur-xl border border-white/10 rounded-full 
           shadow-[0_8px_32px_rgba(0,0,0,0.3)] transition-transform duration-500 ease-in-out"
  >
    <div class="px-6 py-3 md:px-8 md:py-4 flex items-center justify-between">
      <a href="/" class="flex items-center">
        <h3
          class="text-[#69c7c7] text-2xl md:text-3xl font-bold drop-shadow-[0_0_10px_rgba(105,199,199,0.5)]"
        >
          PortFolio
        </h3>
      </a>

      <ul id="navbar-links" class="hidden md:flex items-center space-x-8">
        {
          links.map((link) => (
            <li>
              <a
                href={link.href}
                class="nav-link text-sm uppercase tracking-wider font-bold transition-all duration-300 text-white/80 hover:text-[#69c7c7] hover:scale-105"
              >
                {link.name}
              </a>
            </li>
          ))
        }

        <li class="flex items-center gap-3 pl-4 border-l border-white/10">
          <a
            href="https://github.com/hooom1234"
            target="_blank"
            rel="noopener noreferrer"
            aria-label="GitHub"
          >
            <FaGithub className="h-6 w-6 cursor-pointer text-white hover:text-[#7836cf] transition-colors" />
          </a>
        </li>
      </ul>

      <div class="flex md:hidden items-center gap-4 z-50">
        
        <label for="menu-toggle" class="cursor-pointer p-1 hover:bg-white/10 rounded-full transition-colors">
          <FiMenu className="h-6 w-6 text-white peer-checked:hidden" />
          <FiX className="h-6 w-6 text-white hidden peer-checked:block" />
        </label>
      </div>
    </div>
  </nav>

  <label
    for="menu-toggle"
    class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden peer-checked:block cursor-pointer z-40 md:hidden transition-opacity"
  ></label>

  <div
    class="fixed top-0 right-0 h-full w-72 bg-gray-900/95 backdrop-blur-xl border-l border-white/10 shadow-2xl transform translate-x-full transition-transform duration-300 peer-checked:translate-x-0 z-50 md:translate-x-full md:hidden"
  >
    <div class="flex justify-between items-center p-6 border-b border-white/10">
      <span class="text-white font-bold text-xl">Menu</span>
      <label for="menu-toggle" class="cursor-pointer p-1 hover:bg-white/10 rounded-full">
        <FiX className="h-6 w-6 text-white" />
      </label>
    </div>

    <ul id="navbar-links-mobile" class="flex flex-col space-y-2 p-6">
      {
        links.map((link) => (
          <li>
            <a
              href={link.href}
              class="nav-link-mobile block px-4 py-3 rounded-xl text-lg font-medium text-white/90 hover:bg-white/5 hover:text-[#69c7c7] transition-all duration-300"
            >
              {link.name}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</nav>

<script>
  (function () {
    // --- Logic 1: Scroll to Hide/Show Navbar (UPDATED) ---
    const navbar = document.getElementById("navbar-header");
    let lastScrollY = window.scrollY;

    function handleScroll() {
        if (!navbar) return;
        
        const currentScrollY = window.scrollY;
        
        // ถ้าเลื่อนลงเยอะๆ ให้ซ่อน
        if (currentScrollY > lastScrollY && currentScrollY > 50) {
            // ซ่อน Navbar: ดึงขึ้นไปข้างบน (-150%) 
            // **สำคัญ** ต้องคง -50% ของแกน X ไว้ เพื่อให้มันยังอยู่ตรงกลาง
            navbar.style.transform = "translate(0, -200%)";
        } else {
            // แสดง Navbar: กลับมาที่เดิม (Y=0)
            navbar.style.transform = "translate(0, 0)";
        }
        
        lastScrollY = currentScrollY;
    }

    window.addEventListener("scroll", handleScroll);

    // --- Logic 2: Mark Active Links (เหมือนเดิม) ---
    function markActiveLinks() {
      const currentPath = window.location.pathname.replace(/\/$/, "") || "/";
      const desktopLinks = Array.from(document.querySelectorAll("#navbar-links .nav-link"));
      const mobileLinks = Array.from(document.querySelectorAll("#navbar-links-mobile .nav-link-mobile"));
      const allLinks = [...desktopLinks, ...mobileLinks];

      allLinks.forEach((link) => {
        const hrefAttr = link.getAttribute("href");
        const href = hrefAttr?.replace(/\/$/, "") || "" || "/";

        if (href === currentPath) {
          // สไตล์สำหรับ Desktop Active
          if(link.classList.contains('nav-link')) {
             link.classList.add("text-[#69c7c7]", "scale-110");
             link.classList.remove("text-white/80");
          }
          // สไตล์สำหรับ Mobile Active
          if(link.classList.contains('nav-link-mobile')) {
             link.classList.add("text-[#69c7c7]", "bg-white/10");
          }
        } else {
          link.classList.remove("text-[#69c7c7]", "scale-110", "bg-white/10");
          if(link.classList.contains('nav-link')) link.classList.add("text-white/80");
        }
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", markActiveLinks);
    } else {
      markActiveLinks();
    }
    
    // Astro View Transitions Support
    window.addEventListener("popstate", markActiveLinks);
    document.addEventListener("astro:page-load", markActiveLinks);
    document.addEventListener("astro:after-swap", markActiveLinks);
  })();
</script>