---
// src/pages/lksbrightsteps.astro
import Layout from "../../layouts/Layout.astro";
import { projectData } from "../../data/myproject/lksbrightsteps";

// Helper function
const getBadgeColor = (tech: string) => {
  if (tech.includes("React")) return "bg-sky-500/20 text-sky-300 border-sky-500/50";
  if (tech.includes("PHP")) return "bg-purple-500/20 text-purple-300 border-purple-500/50";
  if (tech.includes("SQL")) return "bg-orange-500/20 text-orange-300 border-orange-500/50";
  return "bg-slate-700/50 text-slate-300 border-slate-600";
};

const getSectionContent = (id: string) => {
  return projectData.sections.find(s => s.id === id)?.content || "";
};
---

<Layout title={`${projectData.title}`} description={projectData.description}>
  
  <main class="relative bg-[#0b1121] min-h-screen text-slate-300 selection:bg-sky-500/30 overflow-hidden">
    
    {/* --- Background Effects --- */}
    <div class="absolute inset-0 z-0 bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"></div>
    <div class="absolute top-0 -left-4 w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"></div>
    <div class="absolute top-0 -right-4 w-72 h-72 bg-sky-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"></div>
    <div class="fixed inset-0 z-0 pointer-events-none opacity-20 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] mix-blend-overlay"></div>

    {/* --- Content Area --- */}
    <article class="relative z-10 container mx-auto px-4 md:px-0 py-20 max-w-4xl mt-15">
      
      {/* 1. Header Section */}
      <header class="mb-12 animate-fade-in-down text-center">
        <h1 class="text-4xl md:text-6xl font-bold text-white mb-4 tracking-tight">
          {projectData.title}
        </h1>
        <p class="text-xl text-slate-400 mb-6 font-light">
          {projectData.subtitle}
        </p>
        
        {/* Tech Stack Tags */}
        <div class="flex flex-wrap justify-center gap-3">
          {projectData.tags.map((tag) => (
            <span class={`px-3 py-1 rounded-full text-sm border ${getBadgeColor(tag)}`}>
              {tag}
            </span>
          ))}
        </div>
      </header>

      {/* 2. Youtube Video Section */}
      <section class="mb-16 reveal-on-scroll shadow-2xl shadow-sky-900/20 rounded-2xl overflow-hidden border border-slate-800 bg-slate-900/50 backdrop-blur-sm">
        <div class="aspect-video w-full bg-slate-950 relative">
           <iframe 
             class="w-full h-full"
             src="https://www.youtube.com/embed/P_52VBzn7qQ" 
             title="YouTube video player" 
             frameborder="0" 
             allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
             referrerpolicy="strict-origin-when-cross-origin" 
             allowfullscreen
           ></iframe>
        </div>
      </section>

      {/* 3. Overview & Images (Updated to Masonry Layout) */}
      <section class="mb-16 reveal-on-scroll space-y-8">
        <h2 class="text-3xl font-bold text-white border-l-4 border-sky-500 pl-4">
          Overview
        </h2>
        <p class="text-lg leading-relaxed text-slate-300">
          {projectData.description}
        </p>
        
        {/* ✨ UPDATED: ใช้ columns แทน grid เพื่อให้กรอบสูงเท่ารูปภาพพอดี (Masonry Style) ✨ */}
        <div class="columns-1 md:columns-2 gap-6 mt-8 space-y-6">
           {projectData.gallery?.map((image, index) => (
              /* เพิ่ม break-inside-avoid เพื่อไม่ให้การ์ดขาดตอน */
              <div class="break-inside-avoid flex flex-col rounded-xl bg-slate-800/50 border border-slate-700 overflow-hidden group hover:border-sky-500/50 transition-colors shadow-lg">
                  <div class="relative overflow-hidden w-full h-auto bg-slate-900/50">
                      <img 
                        src={image.src}
                        alt={image.alt}
                        class="zoomable-image w-full h-auto object-cover cursor-zoom-in group-hover:scale-105 transition-transform duration-500"
                      />
                  </div>
                  
                  <div class="p-4 bg-[#0f172a] border-t border-slate-700/50">
                    <span class="text-sm font-mono text-center block text-sky-300/90">
                        {image.caption}
                    </span>
                  </div>
              </div>
           ))}
        </div>
      </section>

      {/* 4. Architecture & Logic */}
      <section class="mb-16 reveal-on-scroll">
         <h2 class="text-3xl font-bold text-white border-l-4 border-purple-500 pl-4 mb-6">
           System Architecture & Logic
         </h2>
         
         <p class="mb-6 text-slate-300">
           {getSectionContent('architecture')}
         </p>

         {/* Code Blocks */}
         <div class="mb-8">
            <h3 class="text-xl font-semibold text-white mb-3 flex items-center gap-2">
              <span class="text-sky-400">#</span> Authentication API & Logic
            </h3>
            <div class="mockup-code bg-[#1e293b] text-sm rounded-lg overflow-hidden border border-slate-700 shadow-lg">
               <div class="flex items-center px-4 py-2 bg-slate-800 border-b border-slate-700">
                  <div class="flex gap-2">
                     <div class="w-3 h-3 rounded-full bg-red-500"></div>
                     <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                     <div class="w-3 h-3 rounded-full bg-green-500"></div>
                  </div>
                  <span class="ml-4 text-xs text-slate-400">LoginScreen.js / login-Reporter.php</span>
               </div>
               <div class="p-4 overflow-x-auto">
                 <pre class="text-pink-400"><code>{projectData.codeSnippets.login}</code></pre>
                 <div class="my-4 border-t border-slate-700/50"></div>
                 <pre class="text-blue-300"><code>{projectData.codeSnippets.backendLogin}</code></pre>
               </div>
            </div>
         </div>

         <div class="mb-8">
            <h3 class="text-xl font-semibold text-white mb-3 flex items-center gap-2">
              <span class="text-purple-400">#</span> Data Recording API & Logic
            </h3>
            <div class="mockup-code bg-[#1e293b] text-sm rounded-lg overflow-hidden border border-slate-700 shadow-lg">
               <div class="flex items-center px-4 py-2 bg-slate-800 border-b border-slate-700">
                  <span class="text-xs text-slate-400">reporting.js / save_student.php</span>
               </div>
               <div class="p-4 overflow-x-auto">
                 <pre class="text-green-300"><code>{projectData.codeSnippets.saveData}</code></pre>
               </div>
               <div class="flex items-center px-4 py-2 bg-slate-800 border-b border-slate-700">
               </div>
               <div class="p-4 overflow-x-auto">
                 <pre class="text-blue-300"><code>{projectData.codeSnippets.backendsaveData}</code></pre>
               </div>
            </div>
         </div>

         <div class="mb-8">
            <h3 class="text-xl font-semibold text-white mb-3 flex items-center gap-2">
              <span class="text-purple-400">#</span> Get Data API & Logic
            </h3>
            <div class="mockup-code bg-[#1e293b] text-sm rounded-lg overflow-hidden border border-slate-700 shadow-lg">
               <div class="flex items-center px-4 py-2 bg-slate-800 border-b border-slate-700">
                  <span class="text-xs text-slate-400">student_history.js / student_history.php</span>
               </div>
               <div class="p-4 overflow-x-auto">
                 <pre class="text-pink-400"><code>{projectData.codeSnippets.getdata_history}</code></pre>
               </div>
               <div class="flex items-center px-4 py-2 bg-slate-800 border-b border-slate-700">
                  
               </div>
               <div class="p-4 overflow-x-auto">
                 <pre class="text-blue-300"><code>{projectData.codeSnippets.backendgetdata_history}</code></pre>
               </div>
            </div>
         </div>
      </section>

      {/* 5. Conclusion */}
      <section class="reveal-on-scroll text-center py-10 border-t border-slate-800">
        <a href="/" class="inline-block mt-8 px-6 py-3 rounded-lg bg-slate-800 hover:bg-slate-700 text-white transition-all duration-300 border border-slate-700">
          ← Back to Portfolio
        </a>
      </section>

    </article>

    {/* Lightbox Modal */}
    <div id="imageModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/90 backdrop-blur-sm opacity-0 transition-opacity duration-300">
      <button id="closeModal" class="absolute top-5 right-5 text-white/70 hover:text-white transition-colors z-50 p-2 bg-black/50 rounded-full">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
      </button>
      <img id="expandedImg" src="" alt="Expanded View" class="max-w-[95%] max-h-[90vh] object-contain rounded-lg shadow-2xl border border-slate-700/50 transform scale-95 transition-transform duration-300">
    </div>
    
  </main>
</Layout>

<style>
  /* --- Animation CSS --- */
  .reveal-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.5, 0, 0, 1);
  }

  .reveal-on-scroll.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @keyframes blob {
    0% { transform: translate(0px, 0px) scale(1); }
    33% { transform: translate(30px, -50px) scale(1.1); }
    66% { transform: translate(-20px, 20px) scale(0.9); }
    100% { transform: translate(0px, 0px) scale(1); }
  }
  .animate-blob {
    animation: blob 7s infinite;
  }
  .animation-delay-2000 {
    animation-delay: 2s;
  }
  
  @keyframes fadeInDown {
    from { opacity: 0; transform: translate3d(0, -20px, 0); }
    to { opacity: 1; transform: translate3d(0, 0, 0); }
  }
  .animate-fade-in-down {
    animation: fadeInDown 0.8s ease-out;
  }
</style>

<script>
  // --- Script ---
  const observerOptions = {
    root: null,
    rootMargin: '0px',
    threshold: 0.1
  };

  const observer = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll('.reveal-on-scroll').forEach((section) => {
    observer.observe(section);
  });

  // Lightbox Script
  const modal = document.getElementById('imageModal');
  const expandedImg = document.getElementById('expandedImg') as HTMLImageElement;
  const closeBtn = document.getElementById('closeModal');
  const zoomableImages = document.querySelectorAll('.zoomable-image');

  zoomableImages.forEach(img => {
      img.addEventListener('click', (e) => {
          const target = e.target as HTMLImageElement;
          expandedImg.src = target.src;
          
          if (modal) {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                if(expandedImg) {
                  expandedImg.classList.remove('scale-95');
                  expandedImg.classList.add('scale-100');
                }
            }, 10);
          }
      });
  });

  const closeModal = () => {
      if (modal) {
        modal.classList.add('opacity-0');
        if(expandedImg) {
          expandedImg.classList.remove('scale-100');
          expandedImg.classList.add('scale-95');
        }
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
      }
  };

  if(closeBtn) closeBtn.addEventListener('click', closeModal);
  if(modal) {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
  }
</script>